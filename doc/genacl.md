## genacl.py

Generates Fortigate ACL from a proto-policy written in the following format (e.g. generated by ipaclmatch.py):

```txt
IP-address Netmask Protocol:Port
```
or

```txt
SrcIP SrcMask DstIP DstMask Protocol:Port [Action] [#Comment]
```
IP addresses and netmasks can be in the following format 

```txt
0.0.0.0 0.0.0.0
any
2.3.4.5/32
2.3.4.5 255.255.255.255
3.4.5.0/24
```

Services can have the following forms (more possible formats to follow :
```txt
tcp:22
icmp
*
udp:1234-3456
```

### Usage:

```txt
genacl.py --help
usage: genacl.py [-h] [-v] [-s SRC | -d DST] [--deny] [--log | --nolog]
                 [--comment COMMENT] [--dev {asa,fgt}] [--acl [ACL]] [--ln LN]
                 [--vdom VDOM] [--si SI] [--di DI] [--rn RN] [--label LABEL]
                 [pol]

Creates Cisco ASA or Fortigate policy

positional arguments:
  pol                Firewall policy or "-" to read from the console (default)

optional arguments:
  -h, --help         show this help message and exit
  -v, --verbose      Verbose mode. Messages are sent to STDERR. To increase
                     the level add "v", e.g. -vvv
  -s SRC, --src SRC  Source IP-address/netmask or object name
  -d DST, --dst DST  Destination IP-address/netmasks or object name
  --deny             Use deny by default instead of permit
  --log              Logging. Default: none for ASA, utm for FGT.
  --nolog            Logging. Default: none for ASA, utm for FGT.
  --comment COMMENT  Comment, Default - none
  --dev {asa,fgt}    Type of device: asa (default) or fgt

Cisco ASA:
  --acl [ACL]        ACL name for ASA. Default=Test_ACL
  --ln LN            Starting line number for ASA. Default - 0 (no line
                     numbers)

Fortigate:
  --vdom VDOM        VDOM name for FortiGate. Default - none
  --si SI            Source interface for FortiGate. Default - any
  --di DI            Destination interface for FortiGate. Default - any
  --rn RN            Starting rule number for Fortigate. Default - 10000
  --label LABEL      Section label, Default - none

```


### Examples

Considering the following proto-policy:

```txt
10.228.0.0 255.252.0.0 10.3.0.2 255.255.255.255 tcp:123
13.20.0.0 255.255.0.0 10.3.0.2 255.255.255.255 udp:53
13.20.0.0 255.255.0.0 10.3.0.1 255.255.255.255 udp:53 deny
13.20.0.0 255.255.0.0 10.3.8.4 255.255.255.254 udp:53
10.192.0.0 255.248.0.0 10.3.8.4 255.255.255.254 udp:20000-30000
  # This is a comment
10.0.0.0 255.0.0.0 10.3.9.4 255.255.255.254 *
0.0.0.0 0.0.0.0 10.3.10.0 255.255.255.0 udp:30000-65535
1.2.3.4,1.2.3.5/32 5.6.7.0/24,5.6.8.0/24 tcp:443
1.2.3.4,  1.2.3.5/32 		5.6.7.0/24  , 5.6.8.0/24	 tcp:80
any 10.3.11.0 255.255.255.0 tcp:22
11.2.3.0 255.255.255.0 any tcp:23
0.0.0.0 0.0.0.0 0.0.0.0 0.0.0.0 * deny #Deny the rest

```


default settings will produce the following output:

`cat test-pol.acl | genacl.py --dev fgt`

```txt

config firewall address
 edit n-010.003.008.004_31
  set subnet 10.3.8.4 255.255.255.254
 next
 edit n-010.192.000.000_13
  set subnet 10.192.0.0 255.248.0.0
 next
 edit n-010.228.000.000_14
  set subnet 10.228.0.0 255.252.0.0
 next
 edit h-010.003.000.002
  set subnet 10.3.0.2 255.255.255.255
 next
 edit n-010.003.011.000_24
  set subnet 10.3.11.0 255.255.255.0
 next
 edit n-011.002.003.000_24
  set subnet 11.2.3.0 255.255.255.0
 next
 edit n-013.020.000.000_16
  set subnet 13.20.0.0 255.255.0.0
 next
 edit n-010.003.009.004_31
  set subnet 10.3.9.4 255.255.255.254
 next
 edit n-005.006.008.000_24
  set subnet 5.6.8.0 255.255.255.0
 next
 edit h-001.002.003.004
  set subnet 1.2.3.4 255.255.255.255
 next
 edit n-010.000.000.000_8
  set subnet 10.0.0.0 255.0.0.0
 next
 edit h-010.003.000.001
  set subnet 10.3.0.1 255.255.255.255
 next
 edit n-010.003.010.000_24
  set subnet 10.3.10.0 255.255.255.0
 next
 edit all
  set subnet any
 next
 edit h-001.002.003.005
  set subnet 1.2.3.5 255.255.255.255
 next
 edit n-005.006.007.000_24
  set subnet 5.6.7.0 255.255.255.0
 next
end
config firewall service custom
 edit udp-30000-65535
  set protocol TCP/UDP/SCTP
  set udp-portrange 30000-65535
 next
 edit tcp-123
  set protocol TCP/UDP/SCTP
  set tcp-portrange 123
 next
 edit udp-20000-30000
  set protocol TCP/UDP/SCTP
  set udp-portrange 20000-30000
 next
 edit udp-53
  set protocol TCP/UDP/SCTP
  set udp-portrange 53
 next
end
config firewall policy
 edit 10000
  set srcintf any
  set dstintf any
  set srcaddr n-010.228.000.000_14
  set dstaddr h-010.003.000.002
  set service tcp-123
  set schedule always
  set status enable
  set action accept
 next
 edit 10001
  set srcintf any
  set dstintf any
  set srcaddr n-013.020.000.000_16
  set dstaddr h-010.003.000.002
  set service udp-53
  set schedule always
  set status enable
  set action accept
 next
 edit 10002
  set srcintf any
  set dstintf any
  set srcaddr n-013.020.000.000_16
  set dstaddr h-010.003.000.001
  set service udp-53
  set schedule always
  set status enable
  set action deny
 next
 edit 10003
  set srcintf any
  set dstintf any
  set srcaddr n-013.020.000.000_16
  set dstaddr n-010.003.008.004_31
  set service udp-53
  set schedule always
  set status enable
  set action accept
 next
 edit 10004
  set srcintf any
  set dstintf any
  set srcaddr n-010.192.000.000_13
  set dstaddr n-010.003.008.004_31
  set service udp-20000-30000
  set schedule always
  set status enable
  set action accept
 next
 edit 10005
  set srcintf any
  set dstintf any
  set srcaddr 
  set dstaddr 
  set service 
  set schedule always
  set status enable
  set action accept
  set global-label " This is a comment"
  set comments "  This is a comment"
 next
 edit 10006
  set srcintf any
  set dstintf any
  set srcaddr n-010.000.000.000_8
  set dstaddr n-010.003.009.004_31
  set service ALL
  set schedule always
  set status enable
  set action accept
  set global-label " This is a comment"
 next
 edit 10007
  set srcintf any
  set dstintf any
  set srcaddr all
  set dstaddr n-010.003.010.000_24
  set service udp-30000-65535
  set schedule always
  set status enable
  set action accept
  set global-label " This is a comment"
 next
 edit 10008
  set srcintf any
  set dstintf any
  set srcaddr h-001.002.003.004 h-001.002.003.005
  set dstaddr n-005.006.007.000_24 n-005.006.008.000_24
  set service HTTPS
  set schedule always
  set status enable
  set action accept
  set global-label " This is a comment"
 next
 edit 10009
  set srcintf any
  set dstintf any
  set srcaddr h-001.002.003.004 h-001.002.003.005
  set dstaddr n-005.006.007.000_24 n-005.006.008.000_24
  set service HTTP
  set schedule always
  set status enable
  set action accept
  set global-label " This is a comment"
 next
 edit 10010
  set srcintf any
  set dstintf any
  set srcaddr all
  set dstaddr n-010.003.011.000_24
  set service SSH
  set schedule always
  set status enable
  set action accept
  set global-label " This is a comment"
 next
 edit 10011
  set srcintf any
  set dstintf any
  set srcaddr n-011.002.003.000_24
  set dstaddr all
  set service TELNET
  set schedule always
  set status enable
  set action accept
  set global-label " This is a comment"
 next
 edit 10012
  set srcintf any
  set dstintf any
  set srcaddr all
  set dstaddr all
  set service ALL
  set schedule always
  set status enable
  set action deny
  set global-label " This is a comment"
  set comments " Deny the rest"
 next
end
end

```
